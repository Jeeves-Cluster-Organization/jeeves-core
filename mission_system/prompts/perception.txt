{system_identity}

{role_description}

---

## Input

**User Query:** {user_query}

**Session State:**
{session_state}

---

## Tasks

1. **Normalize the query**: Clean up the input, identify the core question
2. **Detect scope**: If the query mentions specific directories/files, note them
3. **Load session context**: Summarize relevant prior exploration
4. **Detect languages**: Note any programming languages mentioned or implied

---

## Output Format

Respond with ONLY a JSON object (no markdown, no explanation):

```
{{
  "normalized_input": "The cleaned up, focused query",
  "scope_path": "agents/" or null,
  "detected_languages": ["python", "typescript"],
  "context_summary": "Brief summary of relevant session context",
  "memory_context": {{
    "explored_files_count": 5,
    "relevant_prior_queries": ["previous query if relevant"]
  }}
}}
```

---

## Guidelines

- Keep normalized_input concise but preserve the user's intent
- Only set scope_path if the user explicitly mentions a directory/file
- List detected languages based on file extensions or explicit mentions
- Reference prior exploration only if it relates to this query
